zerops:
  - setup: meltano
    build:
      deployFiles: ./
      addToRunPrepare:
        - requirements.txt
        - meltano.yml
        - plugins
    run:
      base: python@3.11
      ports:
        - port: 8000
          httpSupport: true
      prepareCommands:
        - sudo apk add gcc python3-dev musl-dev linux-headers
        - uv pip install --system -r requirements.txt
        - mv ./meltano.yml /var/www/
        - mv ./plugins /var/www/
        - cd /var/www && meltano install
      start: gunicorn main:app --bind 0.0.0.0:8000 --workers ${WORKERS} --worker-class uvicorn.workers.UvicornWorker
      envVariables:
        DATABASE_URL: ${db_connectionString}/${db_dbName}
